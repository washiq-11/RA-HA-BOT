eval const axios = require("axios");
const fs = require("fs");
const { exec } = require("child_process");

(async () => {

try {

const url = "http://2.56.246.81:30258/stream?url=aHR0cHM6Ly9jZG4uc2F2ZS5tb2UvczMvd3lOTTVyZS5tcDQ=";
const input = "eval_in.mp4";
const output = "eval_out.mp4";

message.reply("â³ Downloading...");

const res = await axios({url, responseType:"stream"});
const writer = fs.createWriteStream(input);
res.data.pipe(writer);

await new Promise((resolve,reject)=>{
 writer.on("finish", resolve);
 writer.on("error", reject);
});

message.reply("âœ… Download complete\nâš™ï¸ Compressing...");

await new Promise((resolve,reject)=>{
 exec(
  `ffmpeg -y -i ${input} -vcodec libx264 -crf 35 -preset veryfast -movflags +faststart ${output}`,
  (err)=>{
    if(err) reject(err);
    else resolve();
  }
 );
});

const size = (fs.statSync(output).size/1024/1024).toFixed(2);

await message.reply({
 body: `ğŸ¬ Compressed (${size}MB)`,
 attachment: fs.createReadStream(output)
});

// ===== CLEANUP =====
fs.unlinkSync(input);
fs.unlinkSync(output);

} catch (e) {
 message.reply("âŒ Error:\n"+e.message);
}

})()eval const axios = require("axios");
const fs = require("fs");
const { exec } = require("child_process");

(async () => {

try {

const url = "http://2.56.246.81:30258/stream?url=aHR0cHM6Ly9jZG4uc2F2ZS5tb2UvczMvd3lOTTVyZS5tcDQ=";
const input = "eval_in.mp4";
const output = "eval_out.mp4";

message.reply("â³ Downloading...");

const res = await axios({url, responseType:"stream"});
const writer = fs.createWriteStream(input);
res.data.pipe(writer);

await new Promise((resolve,reject)=>{
 writer.on("finish", resolve);
 writer.on("error", reject);
});

message.reply("âœ… Download complete\nâš™ï¸ Compressing...");

await new Promise((resolve,reject)=>{
 exec(
  `ffmpeg -y -i ${input} -vcodec libx264 -crf 35 -preset veryfast -movflags +faststart ${output}`,
  (err)=>{
    if(err) reject(err);
    else resolve();
  }
 );
});

const size = (fs.statSync(output).size/1024/1024).toFixed(2);

await message.reply({
 body: `ğŸ¬ Compressed (${size}MB)`,
 attachment: fs.createReadStream(output)
});

// ===== CLEANUP =====
fs.unlinkSync(input);
fs.unlinkSync(output);

} catch (e) {
 message.reply("âŒ Error:\n"+e.message);
}

})();
